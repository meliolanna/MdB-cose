<!DOCTYPE html>
<html>
<head>
    <title>Mappa spettacoli</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20n6sQ+a9h2Of3g0t0iDAIofj6z3+L0z4t2qM7Fj+A0="
        crossorigin=""></script>
    <style>
        #map { height: 400px; }
      .info {
          padding: 6px 8px;
          font: 14px/16px Arial, Helvetica, sans-serif;
          background: white;
          background: rgba(255,255,255,0.8);
          box-shadow: 0 0 15px rgba(0,0,0,0.2);
          border-radius: 5px;
      }
      .legend {
          line-height: 18px;
          color: #555;
      }
      .legend i {
          width: 18px;
          height: 18px;
          float: left;
          margin-right: 8px;
          opacity: 0.7;
      }
    </style>
</head>
<body>

    <div id="map"></div>

    <script>
        var map = L.map('map').setView([44.638241, 10.457681], 5);
       L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 12,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

      // red marker for our tornei
        var redIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
  			iconAnchor: [12, 41],
  			popupAnchor: [1, -34],
  			shadowSize: [41, 41]
        });

        // blu icon for shows
        var blueIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
  			iconAnchor: [12, 41],
  			popupAnchor: [1, -34],
  			shadowSize: [41, 41]
        });
      
      // green icon
      var greenIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
  			iconAnchor: [12, 41],
  			popupAnchor: [1, -34],
  			shadowSize: [41, 41]
        });

        // marker for our location
        L.marker([44.638241, 10.457681], {icon: greenIcon}).addTo(map)
            .bindPopup("Noi siamo qui!");

      
        // URL del tuo file JSON grezzo su GitHub
        var jsonUrl = 'https://raw.githubusercontent.com/meliolanna/MdB-cose/main/events.json';

        fetch(jsonUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Errore di rete: ' + response.statusText);
                }
                return response.json();
            })
            .then(events => {
                // Itera su ogni evento e crea un marker
                events.forEach(function(event) {
                    var lat = event.latitude;
                    var lon = event.longitude;
                    var name = event.name;
                    var place = event.place;
                  	var date = event.start_date;
                 	var formattedDate = date.split(' ')[0];
                  	var type = event.event_type;
                  	var icon = blueIcon;
                  	if (type == 'Torneo' || type == 'Campionato') {
                      icon = redIcon;
                    }
                    var marker = L.marker([lat, lon], {icon: icon}).addTo(map)
                  .bindPopup(`<b>${name}</b><br>${place}  ${formattedDate}`);
                });
            })
            .catch(error => console.error('Errore durante il caricamento del file JSON:', error));
      

      // Crea un controllo per la legenda
      var legend = L.control({position: 'bottomright'});

      // Definisci il contenuto HTML della legenda
      legend.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'info legend');
        var labels = ['Spettacoli', 'Tornei e Campionati'];
        var colors = ['#2A81CB', '#CB2B3E']; 

        // Genera il contenuto della legenda in base ai colori e alle etichette
        for (var i = 0; i < colors.length; i++) {
          div.innerHTML +=
            '<i style="background:' + colors[i] + '"></i> ' + labels[i] + '<br>';
        }

        return div;
      };

      // Aggiungi la legenda alla mappa
      legend.addTo(map);
    </script>

</body>
</html>
